<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GaliPocha - Sistema de Turnos Rotativo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Reset y estilos base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --verde-principal: #1a5d1a;
            --verde-claro: #d4edda;
            --verde-medio: #28a745;
            --verde-oscuro: #0d3b0d;
            --blanco: #FFFFFF;
            --gris-claro: #f8f9fa;
            --gris-medio: #e9ecef;
            --gris-oscuro: #495057;
            --rojo: #dc3545;
            --azul: #007bff;
            --amarillo: #ffc107;
            --dorado: #ffd700;
            --naranja: #fd7e14;
            --sombra: 0 4px 6px rgba(0, 0, 0, 0.1);
            --borde-radius: 10px;
            --transicion: all 0.3s ease;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a5d1a 0%, #28a745 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 15px;
        }

        .app-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: var(--blanco);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            min-height: calc(100vh - 30px);
            display: flex;
            flex-direction: column;
            border: 3px solid var(--dorado);
        }

        /* Header */
        .app-header {
            background: linear-gradient(135deg, var(--verde-oscuro), var(--verde-principal));
            color: var(--blanco);
            padding: 20px 15px;
            text-align: center;
            position: relative;
            overflow: hidden;
            border-bottom: 4px solid var(--dorado);
        }

        .app-header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(255, 215, 0, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 80% 70%, rgba(255, 215, 0, 0.1) 0%, transparent 20%);
        }

        .logo-container {
            position: relative;
            z-index: 2;
            margin-bottom: 10px;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--dorado);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            letter-spacing: 1px;
        }

        .logo .by {
            font-size: 1rem;
            color: var(--blanco);
            font-weight: normal;
            margin-left: 5px;
        }

        .logo .ferteam {
            color: var(--amarillo);
            font-weight: bold;
        }

        .app-header .subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
            position: relative;
            z-index: 2;
            font-style: italic;
            color: var(--gris-claro);
        }

        /* Indicador de turno mejorado */
        .turno-indicator {
            background: linear-gradient(135deg, var(--amarillo), var(--naranja));
            color: var(--verde-oscuro);
            padding: 12px 20px;
            margin: 0 15px 15px;
            border-radius: var(--borde-radius);
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
            box-shadow: var(--sombra);
            border: 2px solid var(--dorado);
            position: relative;
            overflow: hidden;
            animation: pulse 2s infinite;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .turno-indicator .turno-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .turno-indicator .contador-apuestas {
            background: var(--verde-oscuro);
            color: var(--blanco);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        /* Secciones */
        .section {
            display: none;
            flex: 1;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }

        .section.active {
            display: flex;
            flex-direction: column;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Pantalla de Turno Mejorada */
        .turno-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            padding: 30px 20px;
            text-align: center;
        }

        .info-ronda-turno {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
            width: 100%;
            max-width: 600px;
        }

        .info-card-turno {
            background: var(--gris-claro);
            padding: 20px;
            border-radius: var(--borde-radius);
            border: 2px solid var(--gris-medio);
            text-align: center;
            transition: var(--transicion);
        }

        .info-card-turno:hover {
            transform: translateY(-3px);
            box-shadow: var(--sombra);
        }

        .info-card-turno .label {
            font-size: 0.9rem;
            color: var(--gris-oscuro);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .info-card-turno .value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--verde-principal);
        }

        .info-card-turno .subvalue {
            font-size: 1rem;
            color: var(--verde-medio);
            margin-top: 5px;
        }

        /* Jugador en turno */
        .jugador-turno-container {
            background: linear-gradient(135deg, var(--verde-claro), var(--blanco));
            border-radius: var(--borde-radius);
            padding: 30px;
            margin: 20px 0;
            border: 3px solid var(--verde-medio);
            width: 100%;
            max-width: 600px;
            position: relative;
            overflow: hidden;
        }

        .jugador-turno-container::before {
            content: "üé¥";
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 2rem;
            opacity: 0.2;
        }

        .jugador-turno {
            font-size: 2.2rem;
            color: var(--verde-oscuro);
            margin-bottom: 10px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }

        .pregunta-turno {
            font-size: 1.3rem;
            color: var(--gris-oscuro);
            margin-bottom: 5px;
            line-height: 1.4;
        }

        /* Informaci√≥n de apuestas acumuladas */
        .info-apuestas-acumuladas {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border: 2px solid var(--azul);
            border-radius: var(--borde-radius);
            padding: 15px;
            margin: 15px 0;
            color: var(--verde-oscuro);
            font-size: 1.1rem;
            width: 100%;
            max-width: 600px;
        }

        .info-apuestas-acumuladas .titulo {
            font-weight: bold;
            color: var(--azul);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-apuestas-acumuladas .datos {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .dato-apuesta {
            background: var(--blanco);
            padding: 10px;
            border-radius: 8px;
            border: 1px solid var(--gris-medio);
        }

        .dato-apuesta .label {
            font-size: 0.9rem;
            color: var(--gris-oscuro);
        }

        .dato-apuesta .valor {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--verde-principal);
        }

        /* Botones de apuesta mejorados */
        .apuestas-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin: 25px 0;
            max-width: 500px;
        }

        .btn-apuesta {
            padding: 25px 10px;
            font-size: 1.6rem;
            font-weight: bold;
            border: 3px solid var(--gris-medio);
            border-radius: 12px;
            background: var(--blanco);
            color: var(--gris-oscuro);
            cursor: pointer;
            transition: var(--transicion);
            position: relative;
            overflow: hidden;
        }

        .btn-apuesta::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--verde-medio);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .btn-apuesta:hover {
            border-color: var(--verde-medio);
            background: var(--gris-claro);
            transform: translateY(-3px) scale(1.05);
        }

        .btn-apuesta:hover::before {
            transform: scaleX(1);
        }

        .btn-apuesta.active {
            background: linear-gradient(135deg, var(--verde-medio), var(--verde-principal));
            color: var(--blanco);
            border-color: var(--verde-principal);
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }

        .btn-apuesta.active::before {
            background: var(--dorado);
            transform: scaleX(1);
        }

        .btn-apuesta.disabled {
            opacity: 0.4;
            cursor: not-allowed;
            background: var(--gris-claro);
            position: relative;
        }

        .btn-apuesta.disabled::after {
            content: "‚úó";
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--rojo);
            color: var(--blanco);
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }

        .btn-apuesta.disabled:hover {
            transform: none;
            border-color: var(--gris-medio);
        }

        /* Restricci√≥n para √∫ltimo jugador */
        .restriccion-info {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border: 3px solid var(--amarillo);
            border-radius: var(--borde-radius);
            padding: 20px;
            margin: 20px 0;
            color: var(--verde-oscuro);
            font-size: 1.2rem;
            max-width: 600px;
            animation: shake 0.5s ease;
            width: 100%;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .restriccion-info .icono {
            font-size: 1.5rem;
            color: var(--rojo);
            margin-bottom: 10px;
        }

        .restriccion-info .mensaje {
            margin-bottom: 10px;
            font-weight: 500;
        }

        .restriccion-info .apuesta-prohibida {
            font-size: 2rem;
            font-weight: bold;
            color: var(--rojo);
            margin: 10px 0;
            padding: 10px;
            background: var(--blanco);
            border-radius: 8px;
            border: 2px dashed var(--rojo);
        }

        /* Bot√≥n confirmar */
        .btn-confirmar-container {
            width: 100%;
            max-width: 600px;
            margin-top: 20px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--verde-medio), var(--verde-principal));
            color: var(--blanco);
            border: none;
            padding: 20px 30px;
            border-radius: var(--borde-radius);
            font-size: 1.3rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transicion);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            width: 100%;
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
        }

        .btn-primary:active:not(:disabled) {
            transform: translateY(-1px);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Mesa de juego */
        .mesa-container {
            display: grid;
            gap: 15px;
            margin: 20px 0;
            flex: 1;
        }

        .mesa-2 { grid-template-columns: repeat(2, 1fr); }
        .mesa-3 { grid-template-columns: repeat(3, 1fr); }
        .mesa-4 { grid-template-columns: repeat(2, 1fr); }
        .mesa-5 { grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(2, 1fr); }
        .mesa-6 { grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(2, 1fr); }

        .jugador-card {
            background: var(--blanco);
            border-radius: var(--borde-radius);
            padding: 20px;
            box-shadow: var(--sombra);
            border: 3px solid transparent;
            transition: var(--transicion);
            position: relative;
            overflow: hidden;
        }

        .jugador-card.en-turno {
            border-color: var(--verde-medio);
            background: linear-gradient(135deg, var(--blanco), var(--verde-claro));
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.2);
        }

        .jugador-card.en-turno::before {
            content: "‚ñ∂";
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.2rem;
            color: var(--verde-medio);
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(5px); }
        }

        .jugador-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--gris-medio);
        }

        .jugador-nombre {
            font-weight: 600;
            color: var(--verde-oscuro);
            font-size: 1.2rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 70%;
        }

        .jugador-puntos {
            background: linear-gradient(135deg, var(--verde-medio), var(--verde-principal));
            color: var(--blanco);
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1.3rem;
            min-width: 50px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        /* Panel de control - AHORA CON PUNTUACI√ìN PARCIAL */
        .control-panel {
            background: linear-gradient(135deg, var(--gris-claro), var(--blanco));
            border-radius: var(--borde-radius);
            padding: 25px;
            margin-top: 20px;
            border: 2px solid var(--gris-medio);
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .info-ronda-actual {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            flex: 1;
        }

        .info-card {
            background: var(--blanco);
            padding: 15px;
            border-radius: var(--borde-radius);
            border: 2px solid var(--gris-medio);
            text-align: center;
        }

        .info-card .label {
            font-size: 0.9rem;
            color: var(--gris-oscuro);
            margin-bottom: 5px;
        }

        .info-card .value {
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--verde-principal);
        }

        .info-card .subvalue {
            font-size: 0.9rem;
            color: var(--gris-oscuro);
            margin-top: 5px;
        }

        /* PUNTUACI√ìN PARCIAL - NUEVO ESTILO */
        .puntuacion-parcial-container {
            background: var(--blanco);
            border-radius: var(--borde-radius);
            padding: 20px;
            margin-top: 20px;
            border: 2px solid var(--gris-medio);
            max-height: 300px;
            overflow-y: auto;
        }

        .puntuacion-parcial-container h4 {
            color: var(--verde-oscuro);
            margin-bottom: 15px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .tabla-puntuacion-parcial {
            width: 100%;
            border-collapse: collapse;
        }

        .tabla-puntuacion-parcial th {
            background: linear-gradient(135deg, var(--verde-medio), var(--verde-principal));
            color: var(--blanco);
            padding: 12px 8px;
            text-align: center;
            font-size: 0.9rem;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .tabla-puntuacion-parcial td {
            padding: 10px 8px;
            border-bottom: 1px solid var(--gris-medio);
            text-align: center;
            font-size: 0.9rem;
        }

        .tabla-puntuacion-parcial tr:hover {
            background: var(--gris-claro);
        }

        .tabla-puntuacion-parcial .posicion {
            font-weight: bold;
            color: var(--verde-oscuro);
            width: 40px;
        }

        .tabla-puntuacion-parcial .jugador {
            text-align: left;
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .tabla-puntuacion-parcial .puntos {
            font-weight: bold;
            color: var(--verde-principal);
            width: 60px;
        }

        .tabla-puntuacion-parcial .apuesta-actual {
            color: var(--azul);
            width: 50px;
        }

        .tabla-puntuacion-parcial .bazas-actual {
            color: var(--naranja);
            width: 50px;
        }

        /* Mensaje informativo sobre apuestas de m√°s/menos */
        .mensaje-apuestas-info {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            border: 2px solid var(--verde-medio);
            border-radius: var(--borde-radius);
            padding: 15px;
            margin-top: 15px;
            color: var(--verde-oscuro);
            font-size: 1.1rem;
            animation: fadeIn 0.5s ease;
        }

        .mensaje-apuestas-info .titulo {
            font-weight: bold;
            color: var(--verde-principal);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .mensaje-apuestas-info .diferencia {
            font-size: 1.4rem;
            font-weight: bold;
            margin: 8px 0;
            padding: 8px;
            border-radius: 8px;
            background: var(--blanco);
        }

        .mensaje-apuestas-info .diferencia.mas {
            color: var(--rojo);
            border: 2px solid var(--rojo);
        }

        .mensaje-apuestas-info .diferencia.menos {
            color: var(--azul);
            border: 2px solid var(--azul);
        }

        .mensaje-apuestas-info .diferencia.exacto {
            color: var(--verde-medio);
            border: 2px solid var(--verde-medio);
        }

        /* Acciones ronda */
        .acciones-ronda {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .btn-accion {
            padding: 15px;
            border-radius: var(--borde-radius);
            border: none;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transicion);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--verde-medio), var(--verde-principal));
            color: var(--blanco);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--amarillo), var(--naranja));
            color: var(--verde-oscuro);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--rojo), #c82333);
            color: var(--blanco);
        }

        .btn-accion:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        /* Resultados */
        .resultados-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px 20px;
        }

        .resultados-container h2 {
            color: var(--verde-oscuro);
            margin-bottom: 30px;
            font-size: 2rem;
            text-align: center;
        }

        .tabla-resultados {
            width: 100%;
            max-width: 600px;
            border-collapse: collapse;
            margin: 20px 0;
            background: var(--blanco);
            border-radius: var(--borde-radius);
            overflow: hidden;
            box-shadow: var(--sombra);
        }

        .tabla-resultados th {
            background: linear-gradient(135deg, var(--verde-principal), var(--verde-oscuro));
            color: var(--blanco);
            padding: 20px;
            text-align: left;
            font-size: 1.1rem;
        }

        .tabla-resultados td {
            padding: 15px 20px;
            border-bottom: 1px solid var(--gris-medio);
            font-size: 1.1rem;
        }

        .tabla-resultados tr:hover {
            background: var(--gris-claro);
        }

        .tabla-resultados .ganador {
            background: linear-gradient(135deg, var(--amarillo), #ffd700);
            font-weight: bold;
            color: var(--verde-oscuro);
        }

        .tabla-resultados .ganador td:first-child {
            font-size: 1.3rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .apuestas-container {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .info-ronda-turno, .info-ronda-actual {
                grid-template-columns: 1fr;
            }
            
            .jugador-turno {
                font-size: 1.8rem;
            }
            
            .btn-apuesta {
                padding: 20px 10px;
                font-size: 1.4rem;
            }
            
            .info-apuestas-acumuladas .datos {
                grid-template-columns: 1fr;
            }
            
            .acciones-ronda {
                grid-template-columns: 1fr;
            }
            
            .tabla-puntuacion-parcial {
                font-size: 0.8rem;
            }
            
            .tabla-puntuacion-parcial th,
            .tabla-puntuacion-parcial td {
                padding: 8px 4px;
            }
        }

        @media (max-width: 480px) {
            .apuestas-container {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .jugador-turno {
                font-size: 1.6rem;
            }
            
            .btn-apuesta {
                padding: 18px 10px;
                font-size: 1.3rem;
            }
            
            .info-card-turno .value {
                font-size: 1.5rem;
            }
        }

        /* Clases de utilidad */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        /* Scrollbar personalizado */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--gris-claro);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--verde-medio);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--verde-principal);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="logo-container">
                <div class="logo">
                    GaliPocha<span class="by">by</span><span class="ferteam">Ferteam</span>
                </div>
            </div>
            <div class="subtitle">Sistema de turnos rotativos - Marcador inteligente</div>
        </header>

        <!-- Indicador de turno mejorado -->
        <div id="turno-indicator" class="turno-indicator hidden">
            <div class="turno-info">
                <i class="fas fa-user-clock"></i>
                <span id="turno-text">Turno de: Jugador 1</span>
            </div>
            <div class="contador-apuestas">
                <span id="contador-apuestas-text">Apuestas: 0/6</span>
            </div>
        </div>

        <!-- Men√∫ Principal -->
        <section id="menu-section" class="section active">
            <div class="turno-screen">
                <div class="jugador-turno-container" style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-color: #6c757d;">
                    <h1 style="color: var(--verde-oscuro); margin-bottom: 20px; font-size: 2rem;">
                        <i class="fas fa-play-circle"></i> GaliPocha
                    </h1>
                    
                    <div class="info-ronda-turno">
                        <div class="info-card-turno">
                            <div class="label">Jugadores</div>
                            <div class="value" id="menu-jugadores">6</div>
                            <div class="subvalue">Puedes cambiar</div>
                        </div>
                        <div class="info-card-turno">
                            <div class="label">Rondas Totales</div>
                            <div class="value" id="menu-rondas">24</div>
                            <div class="subvalue">Para 6 jugadores</div>
                        </div>
                    </div>

                    <div class="config-option" style="width: 100%; max-width: 400px; margin: 30px auto;">
                        <h3 style="color: var(--verde-principal); margin-bottom: 15px; text-align: center;">
                            <i class="fas fa-users"></i> Selecciona jugadores
                        </h3>
                        <div class="jugadores-selector" style="display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">
                            <button class="btn-apuesta" data-jugadores="2" style="font-size: 1.2rem; padding: 15px;">2</button>
                            <button class="btn-apuesta" data-jugadores="3" style="font-size: 1.2rem; padding: 15px;">3</button>
                            <button class="btn-apuesta" data-jugadores="4" style="font-size: 1.2rem; padding: 15px;">4</button>
                            <button class="btn-apuesta active" data-jugadores="5" style="font-size: 1.2rem; padding: 15px;">5</button>
                            <button class="btn-apuesta" data-jugadores="6" style="font-size: 1.2rem; padding: 15px;">6</button>
                        </div>
                    </div>

                    <div class="info-apuestas-acumuladas" style="margin-top: 30px;">
                        <div class="titulo">
                            <i class="fas fa-star"></i> Sistema de Puntuaci√≥n
                        </div>
                        <div class="datos">
                            <div class="dato-apuesta">
                                <div class="label">Apuesta 0</div>
                                <div class="valor">+10 pts</div>
                            </div>
                            <div class="dato-apuesta">
                                <div class="label">Apuesta 1</div>
                                <div class="valor">+15 pts</div>
                            </div>
                            <div class="dato-apuesta">
                                <div class="label">Apuesta 2</div>
                                <div class="valor">+20 pts</div>
                            </div>
                            <div class="dato-apuesta">
                                <div class="label">Apuesta 3</div>
                                <div class="valor">+25 pts</div>
                            </div>
                            <div class="dato-apuesta">
                                <div class="label">Apuesta 4</div>
                                <div class="valor">+30 pts</div>
                            </div>
                            <div class="dato-apuesta">
                                <div class="label">Apuesta 5</div>
                                <div class="valor">+35 pts</div>
                            </div>
                            <div class="dato-apuesta">
                                <div class="label">Apuesta 6</div>
                                <div class="valor">+40 pts</div>
                            </div>
                            <div class="dato-apuesta" style="background: linear-gradient(135deg, #ffcccc, #ff9999);">
                                <div class="label">Por fallo</div>
                                <div class="valor">-5 pts c/u</div>
                            </div>
                        </div>
                    </div>

                    <button id="btn-continuar-config" class="btn-primary mt-20" style="max-width: 400px; margin: 30px auto 0;">
                        <i class="fas fa-arrow-right"></i> Configurar Partida
                    </button>
                </div>
            </div>
        </section>

        <!-- Configuraci√≥n de Nombres -->
        <section id="config-section" class="section">
            <div class="turno-screen">
                <div class="jugador-turno-container" style="background: linear-gradient(135deg, #f8f9fa, #e9ecef);">
                    <h2 style="color: var(--verde-oscuro); margin-bottom: 25px; text-align: center;">
                        <i class="fas fa-cog"></i> Configurar Jugadores
                    </h2>
                    
                    <div class="jugadores-config">
                        <div class="inputs-grid" id="inputs-nombres" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 20px 0;">
                            <!-- Los inputs se generan din√°micamente -->
                        </div>
                    </div>

                    <div class="info-apuestas-acumuladas" style="margin: 25px 0;">
                        <div class="titulo">
                            <i class="fas fa-info-circle"></i> Informaci√≥n de Partida
                        </div>
                        <div style="margin-top: 10px;">
                            <p><strong>Jugadores:</strong> <span id="resumen-jugadores">6</span></p>
                            <p><strong>Rondas totales:</strong> <span id="resumen-rondas">24</span></p>
                            <p><strong>Turnos:</strong> Rotar√°n autom√°ticamente cada ronda</p>
                        </div>
                    </div>

                    <div class="btn-confirmar-container">
                        <div style="display: flex; gap: 15px;">
                            <button id="btn-volver-menu" class="btn-primary" style="background: linear-gradient(135deg, #6c757d, #495057);">
                                <i class="fas fa-arrow-left"></i> Volver
                            </button>
                            <button id="btn-iniciar-partida" class="btn-primary">
                                <i class="fas fa-play"></i> ¬°Comenzar!
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Pantalla de Turno -->
        <section id="turno-section" class="section">
            <div class="turno-screen">
                <div class="info-ronda-turno">
                    <div class="info-card-turno">
                        <div class="label">Ronda Actual</div>
                        <div class="value" id="turno-ronda">1</div>
                        <div class="subvalue">de <span id="turno-total">24</span></div>
                    </div>
                    <div class="info-card-turno">
                        <div class="label">Cartas por jugador</div>
                        <div class="value" id="turno-cartas">1</div>
                        <div class="subvalue">Fase: <span id="turno-fase">Ascendente</span></div>
                    </div>
                </div>

                <div class="jugador-turno-container">
                    <div class="jugador-turno" id="jugador-turno">
                        Jugador 1
                    </div>
                    <div class="pregunta-turno" id="pregunta-turno">
                        ¬øCu√°ntas bazas crees que vas a ganar en esta ronda?
                    </div>
                </div>

                <!-- Informaci√≥n de apuestas acumuladas -->
                <div class="info-apuestas-acumuladas">
                    <div class="titulo">
                        <i class="fas fa-chart-line"></i> Resumen de Apuestas
                    </div>
                    <div class="datos">
                        <div class="dato-apuesta">
                            <div class="label">Apuestas realizadas</div>
                            <div class="valor" id="apuestas-realizadas">0</div>
                        </div>
                        <div class="dato-apuesta">
                            <div class="label">Suma actual</div>
                            <div class="valor" id="suma-apuestas">0</div>
                        </div>
                        <div class="dato-apuesta">
                            <div class="label">N√∫mero de ronda</div>
                            <div class="valor" id="numero-ronda">1</div>
                        </div>
                        <div class="dato-apuesta" id="container-apuesta-restante">
                            <div class="label">Apuestas restantes</div>
                            <div class="valor" id="apuestas-restantes">6</div>
                        </div>
                    </div>
                </div>

                <div class="apuestas-container" id="apuestas-container">
                    <!-- Los botones de apuesta se generan din√°micamente -->
                </div>

                <!-- Restricci√≥n para √∫ltimo jugador -->
                <div id="restriccion-info" class="restriccion-info hidden">
                    <div class="icono">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="mensaje">
                        <strong>¬°Atenci√≥n! Eres el √∫ltimo jugador.</strong>
                    </div>
                    <div>
                        La suma de todas las apuestas NO puede ser igual al n√∫mero de ronda (<span id="ronda-numero">1</span>).
                    </div>
                    <div class="apuesta-prohibida" id="apuesta-prohibida">
                        0
                    </div>
                    <div style="font-size: 1rem; margin-top: 10px;">
                        Esta apuesta NO est√° disponible para ti
                    </div>
                </div>

                <div class="btn-confirmar-container">
                    <button id="btn-confirmar-apuesta" class="btn-primary" disabled>
                        <i class="fas fa-check-circle"></i> Confirmar Apuesta
                    </button>
                </div>
            </div>
        </section>

        <!-- Marcador Principal -->
        <section id="marcador-section" class="section">
            <div class="mesa-container" id="mesa-container">
                <!-- Los jugadores se generan din√°micamente -->
            </div>

            <!-- Panel de Control -->
            <div class="control-panel">
                <div class="panel-header">
                    <div class="info-ronda-actual">
                        <div class="info-card">
                            <div class="label">Ronda</div>
                            <div class="value" id="current-ronda">1</div>
                            <div class="subvalue">de <span id="current-total">24</span></div>
                        </div>
                        <div class="info-card">
                            <div class="label">Fase</div>
                            <div class="value" id="current-fase">Ascendente</div>
                            <div class="subvalue"><span id="current-cartas">1</span> carta</div>
                        </div>
                    </div>
                </div>

                <!-- NUEVO: Mensaje informativo sobre apuestas de m√°s/menos -->
                <div id="mensaje-apuestas-info" class="mensaje-apuestas-info hidden">
                    <!-- Se llena din√°micamente -->
                </div>

                <!-- NUEVO: Puntuaci√≥n Parcial (reemplaza al historial) -->
                <div class="puntuacion-parcial-container">
                    <h4><i class="fas fa-chart-bar"></i> Puntuaci√≥n Parcial</h4>
                    <table class="tabla-puntuacion-parcial" id="tabla-puntuacion-parcial">
                        <!-- Se llena din√°micamente -->
                    </table>
                </div>

                <div class="acciones-ronda">
                    <button id="btn-jugar-ronda" class="btn-primary">
                        <i class="fas fa-play"></i> Jugar Ronda
                    </button>
                    <button id="btn-siguiente-ronda" class="btn-primary" style="background: linear-gradient(135deg, #17a2b8, #138496);">
                        <i class="fas fa-forward"></i> Siguiente Ronda
                    </button>
                    <button id="btn-ver-resultados" class="btn-primary" style="background: linear-gradient(135deg, #ffc107, #e0a800); color: #212529;">
                        <i class="fas fa-chart-bar"></i> Resultados
                    </button>
                    <button id="btn-finalizar-partida" class="btn-primary" style="background: linear-gradient(135deg, #dc3545, #c82333);">
                        <i class="fas fa-flag-checkered"></i> Finalizar
                    </button>
                </div>
            </div>
        </section>

        <!-- Resultados Finales -->
        <section id="resultados-section" class="section">
            <div class="turno-screen">
                <div class="jugador-turno-container" style="max-width: 700px;">
                    <h2 style="color: var(--verde-oscuro); margin-bottom: 30px; text-align: center; font-size: 2rem;">
                        <i class="fas fa-trophy"></i> Resultados Finales
                    </h2>
                    
                    <div id="tabla-resultados" style="width: 100%;">
                        <!-- Los resultados se generan din√°micamente -->
                    </div>
                    
                    <div class="btn-confirmar-container mt-20">
                        <div style="display: flex; gap: 15px;">
                            <button id="btn-nueva-partida" class="btn-primary" style="flex: 1;">
                                <i class="fas fa-plus"></i> Nueva Partida
                            </button>
                            <button id="btn-imprimir" class="btn-primary" style="flex: 1; background: linear-gradient(135deg, #6c757d, #495057);">
                                <i class="fas fa-print"></i> Imprimir
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script>
        class GaliPochaApp {
            constructor() {
                this.jugadores = 6;
                this.jugadoresData = [];
                this.rondas = [];
                this.rondaActual = 1;
                this.turnoActual = 0;
                this.apuestasRonda = [];
                this.totalRondas = 24;
                this.partidaActiva = false;
                this.modoTurno = false;
                this.iniciadorRondaActual = 0; // √çndice del jugador que inicia la ronda
                
                // Sistema de puntuaci√≥n personalizado
                this.puntuaciones = {
                    0: 10,   // Apuesta 0: 10 puntos
                    1: 15,   // Apuesta 1: 15 puntos
                    2: 20,   // Apuesta 2: 20 puntos
                    3: 25,   // Apuesta 3: 25 puntos
                    4: 30,   // Apuesta 4: 30 puntos
                    5: 35,   // Apuesta 5: 35 puntos
                    6: 40    // Apuesta 6: 40 puntos
                };
                
                this.penalizacionPorFallar = 5; // -5 puntos por cada apuesta fallada
                
                this.init();
            }

            init() {
                this.cacheDOM();
                this.bindEvents();
                this.actualizarInfoPartida();
            }

            cacheDOM() {
                // Secciones
                this.menuSection = document.getElementById('menu-section');
                this.configSection = document.getElementById('config-section');
                this.turnoSection = document.getElementById('turno-section');
                this.marcadorSection = document.getElementById('marcador-section');
                this.resultadosSection = document.getElementById('resultados-section');
                this.turnoIndicator = document.getElementById('turno-indicator');
                this.contadorApuestasText = document.getElementById('contador-apuestas-text');
                
                // Men√∫
                this.btnJugadores = document.querySelectorAll('.btn-apuesta[data-jugadores]');
                this.btnContinuarConfig = document.getElementById('btn-continuar-config');
                this.menuJugadores = document.getElementById('menu-jugadores');
                this.menuRondas = document.getElementById('menu-rondas');
                
                // Configuraci√≥n
                this.inputsNombres = document.getElementById('inputs-nombres');
                this.btnVolverMenu = document.getElementById('btn-volver-menu');
                this.btnIniciarPartida = document.getElementById('btn-iniciar-partida');
                
                // Turno
                this.jugadorTurnoElement = document.getElementById('jugador-turno');
                this.preguntaTurnoElement = document.getElementById('pregunta-turno');
                this.apuestasContainer = document.getElementById('apuestas-container');
                this.restriccionInfo = document.getElementById('restriccion-info');
                this.apuestaProhibidaElement = document.getElementById('apuesta-prohibida');
                this.rondaNumeroElement = document.getElementById('ronda-numero');
                this.btnConfirmarApuesta = document.getElementById('btn-confirmar-apuesta');
                
                // Informaci√≥n de apuestas acumuladas
                this.apuestasRealizadasElement = document.getElementById('apuestas-realizadas');
                this.sumaApuestasElement = document.getElementById('suma-apuestas');
                this.numeroRondaElement = document.getElementById('numero-ronda');
                this.apuestasRestantesElement = document.getElementById('apuestas-restantes');
                this.containerApuestaRestante = document.getElementById('container-apuesta-restante');
                
                // Info ronda turno
                this.turnoRondaElement = document.getElementById('turno-ronda');
                this.turnoTotalElement = document.getElementById('turno-total');
                this.turnoCartasElement = document.getElementById('turno-cartas');
                this.turnoFaseElement = document.getElementById('turno-fase');
                
                // Marcador
                this.mesaContainer = document.getElementById('mesa-container');
                this.btnJugarRonda = document.getElementById('btn-jugar-ronda');
                this.btnSiguienteRonda = document.getElementById('btn-siguiente-ronda');
                this.btnVerResultados = document.getElementById('btn-ver-resultados');
                this.btnFinalizarPartida = document.getElementById('btn-finalizar-partida');
                
                // NUEVO: Puntuaci√≥n parcial y mensaje informativo
                this.mensajeApuestasInfo = document.getElementById('mensaje-apuestas-info');
                this.tablaPuntuacionParcial = document.getElementById('tabla-puntuacion-parcial');
                
                // Resultados
                this.btnNuevaPartida = document.getElementById('btn-nueva-partida');
                this.btnImprimir = document.getElementById('btn-imprimir');
                
                // Info
                this.resumenJugadores = document.getElementById('resumen-jugadores');
                this.resumenRondas = document.getElementById('resumen-rondas');
                
                // Current info
                this.currentRondaElement = document.getElementById('current-ronda');
                this.currentTotalElement = document.getElementById('current-total');
                this.currentFaseElement = document.getElementById('current-fase');
                this.currentCartasElement = document.getElementById('current-cartas');
            }

            bindEvents() {
                // Men√∫ principal
                this.btnJugadores.forEach(btn => {
                    btn.addEventListener('click', (e) => this.seleccionarJugadores(e));
                });
                
                this.btnContinuarConfig.addEventListener('click', () => this.irAConfiguracion());
                
                // Configuraci√≥n
                this.btnVolverMenu.addEventListener('click', () => this.irAMenu());
                this.btnIniciarPartida.addEventListener('click', () => this.iniciarPartida());
                
                // Turno
                this.btnConfirmarApuesta.addEventListener('click', () => this.confirmarApuesta());
                
                // Marcador
                this.btnJugarRonda.addEventListener('click', () => this.iniciarTurnos());
                this.btnSiguienteRonda.addEventListener('click', () => this.siguienteRonda());
                this.btnVerResultados.addEventListener('click', () => this.verResultadosParciales());
                this.btnFinalizarPartida.addEventListener('click', () => this.finalizarPartida());
                
                // Resultados
                this.btnNuevaPartida.addEventListener('click', () => this.nuevaPartida());
                this.btnImprimir.addEventListener('click', () => window.print());
            }

            seleccionarJugadores(event) {
                const jugadores = parseInt(event.target.dataset.jugadores);
                this.jugadores = jugadores;
                
                // Actualizar botones
                this.btnJugadores.forEach(btn => {
                    btn.classList.remove('active');
                    if (parseInt(btn.dataset.jugadores) === jugadores) {
                        btn.classList.add('active');
                    }
                });
                
                // Actualizar info
                this.actualizarInfoPartida();
            }

            actualizarInfoPartida() {
                this.menuJugadores.textContent = this.jugadores;
                this.resumenJugadores.textContent = this.jugadores;
                
                // Calcular rondas seg√∫n n√∫mero de jugadores
                if (this.jugadores === 6) {
                    this.totalRondas = 24;
                    this.menuRondas.textContent = '24';
                    this.resumenRondas.textContent = '24';
                } else if (this.jugadores === 4) {
                    this.totalRondas = 20;
                    this.menuRondas.textContent = '20';
                    this.resumenRondas.textContent = '20';
                } else {
                    this.totalRondas = 15;
                    this.menuRondas.textContent = '15';
                    this.resumenRondas.textContent = '15';
                }
            }

            irAConfiguracion() {
                this.generarInputsNombres();
                this.mostrarSeccion('config');
            }

            irAMenu() {
                this.mostrarSeccion('menu');
            }

            generarInputsNombres() {
                let html = '';
                for (let i = 1; i <= this.jugadores; i++) {
                    html += `
                        <div class="input-group">
                            <input type="text" id="nombre-j${i}" 
                                   placeholder="Jugador ${i}" 
                                   value="Jugador ${i}"
                                   maxlength="20"
                                   style="width: 100%; padding: 12px; border: 2px solid var(--gris-medio); border-radius: 8px; font-size: 1rem;">
                        </div>
                    `;
                }
                this.inputsNombres.innerHTML = html;
            }

            iniciarPartida() {
                // Obtener nombres de jugadores
                this.jugadoresData = [];
                for (let i = 1; i <= this.jugadores; i++) {
                    const input = document.getElementById(`nombre-j${i}`);
                    const nombre = input ? input.value.trim() || `Jugador ${i}` : `Jugador ${i}`;
                    
                    this.jugadoresData.push({
                        id: i,
                        nombre: nombre,
                        puntos: 0,
                        apuestaActual: null,
                        bazasActual: 0,
                        historial: [],
                        orden: i
                    });
                }
                
                // Inicializar partida
                this.rondas = [];
                this.rondaActual = 1;
                this.turnoActual = 0;
                this.iniciadorRondaActual = 0; // El jugador 1 inicia la ronda 1
                this.apuestasRonda = [];
                this.partidaActiva = true;
                this.modoTurno = false;
                
                // Generar mesa de juego
                this.generarMesa();
                
                // Actualizar UI
                this.actualizarInfoRonda();
                this.mostrarSeccion('marcador');
                this.turnoIndicator.classList.add('hidden');
                
                // Actualizar puntuaci√≥n parcial
                this.actualizarPuntuacionParcial();
                
                // Iniciar primera ronda
                this.iniciarTurnos();
            }

            generarMesa() {
                // Limpiar mesa
                this.mesaContainer.innerHTML = '';
                this.mesaContainer.className = 'mesa-container';
                
                // A√±adir clase seg√∫n n√∫mero de jugadores
                this.mesaContainer.classList.add(`mesa-${this.jugadores}`);
                
                // Generar tarjetas de jugadores
                this.jugadoresData.forEach(jugador => {
                    const card = document.createElement('div');
                    card.className = 'jugador-card';
                    card.dataset.id = jugador.id;
                    
                    card.innerHTML = `
                        <div class="jugador-header">
                            <div class="jugador-nombre" title="${jugador.nombre}">${jugador.nombre}</div>
                            <div class="jugador-puntos">${jugador.puntos}</div>
                        </div>
                        <div class="jugador-body">
                            <div class="apuesta-actual">
                                <span>Apuesta:</span>
                                <span class="apuesta-value" id="apuesta-j${jugador.id}">-</span>
                            </div>
                            <div class="bazas-actual">
                                <span>Bazas:</span>
                                <div class="contador-bazas">
                                    <button class="btn-baza" data-action="minus" data-id="${jugador.id}">-</button>
                                    <span class="bazas-count" id="bazas-j${jugador.id}">0</span>
                                    <button class="btn-baza" data-action="plus" data-id="${jugador.id}">+</button>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    this.mesaContainer.appendChild(card);
                });
                
                // Asignar eventos a los botones de bazas
                this.asignarEventosBazas();
            }

            asignarEventosBazas() {
                document.querySelectorAll('.btn-baza').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        if (!this.modoTurno) {
                            const jugadorId = parseInt(e.target.dataset.id);
                            const action = e.target.dataset.action;
                            this.actualizarBazas(jugadorId, action);
                        }
                    });
                });
            }

            actualizarBazas(jugadorId, action) {
                const jugador = this.jugadoresData.find(j => j.id === jugadorId);
                if (!jugador) return;
                
                const cartasPorRonda = this.calcularCartasPorRonda();
                const maxBazas = cartasPorRonda;
                
                if (action === 'plus' && jugador.bazasActual < maxBazas) {
                    jugador.bazasActual++;
                } else if (action === 'minus' && jugador.bazasActual > 0) {
                    jugador.bazasActual--;
                }
                
                // Actualizar UI
                const countElement = document.getElementById(`bazas-j${jugadorId}`);
                if (countElement) {
                    countElement.textContent = jugador.bazasActual;
                }
                
                // Actualizar puntuaci√≥n parcial
                this.actualizarPuntuacionParcial();
            }

            iniciarTurnos() {
                this.modoTurno = true;
                
                // Calcular el √≠ndice del jugador que inicia esta ronda
                // Ronda 1: jugador 0, Ronda 2: jugador 1, etc.
                const indiceIniciador = (this.rondaActual - 1) % this.jugadores;
                
                // El turno actual es el iniciador
                this.turnoActual = indiceIniciador;
                this.apuestasRonda = [];
                this.restriccionInfo.classList.add('hidden');
                
                // Actualizar contador de apuestas
                this.actualizarContadorApuestas();
                
                // Mostrar indicador de turno
                this.turnoIndicator.classList.remove('hidden');
                this.turnoIndicator.querySelector('#turno-text').textContent = `Ronda ${this.rondaActual} - Turnos`;
                
                // Ocultar mensaje informativo de apuestas
                this.mensajeApuestasInfo.classList.add('hidden');
                
                // Ir a la pantalla de turno
                this.siguienteTurno();
            }

            siguienteTurno() {
                // Calcular √≠ndice del jugador actual considerando el orden rotativo
                const jugadorIndex = (this.iniciadorRondaActual + this.apuestasRonda.length) % this.jugadores;
                const jugador = this.jugadoresData[jugadorIndex];
                
                // Actualizar indicador de turno
                this.turnoIndicator.querySelector('#turno-text').textContent = `Turno: ${jugador.nombre}`;
                
                // Mostrar pantalla de turno
                this.mostrarPantallaTurno(jugador);
            }

            mostrarPantallaTurno(jugador) {
                // Actualizar informaci√≥n de ronda
                this.turnoRondaElement.textContent = this.rondaActual;
                this.turnoTotalElement.textContent = this.totalRondas;
                this.turnoCartasElement.textContent = this.calcularCartasPorRonda();
                this.turnoFaseElement.textContent = this.getFaseActual();
                
                // Mostrar jugador actual
                this.jugadorTurnoElement.textContent = jugador.nombre;
                this.preguntaTurnoElement.textContent = `Ronda ${this.rondaActual} - ¬øCu√°ntas bazas crees que vas a ganar?`;
                
                // Actualizar informaci√≥n de apuestas acumuladas
                this.actualizarInfoApuestasAcumuladas();
                
                // Generar botones de apuesta
                this.generarBotonesApuesta(jugador);
                
                // Actualizar tarjetas de jugadores
                this.actualizarTarjetasJugadores();
                
                // Mostrar secci√≥n de turno
                this.mostrarSeccion('turno');
            }

            actualizarInfoApuestasAcumuladas() {
                const apuestasRealizadas = this.apuestasRonda.length;
                const sumaApuestas = this.apuestasRonda.reduce((sum, apuesta) => sum + apuesta.apuesta, 0);
                const apuestasRestantes = this.jugadores - apuestasRealizadas;
                
                this.apuestasRealizadasElement.textContent = apuestasRealizadas;
                this.sumaApuestasElement.textContent = sumaApuestas;
                this.numeroRondaElement.textContent = this.rondaActual;
                this.apuestasRestantesElement.textContent = apuestasRestantes;
                
                // Actualizar contador en el indicador
                this.contadorApuestasText.textContent = `Apuestas: ${apuestasRealizadas}/${this.jugadores}`;
                
                // Cambiar color si es el √∫ltimo jugador
                if (apuestasRestantes === 1) {
                    this.containerApuestaRestante.style.background = 'linear-gradient(135deg, #fff3cd, #ffeaa7)';
                    this.containerApuestaRestante.style.border = '2px solid var(--amarillo)';
                } else {
                    this.containerApuestaRestante.style.background = '';
                    this.containerApuestaRestante.style.border = '';
                }
            }

            generarBotonesApuesta(jugador) {
                this.apuestasContainer.innerHTML = '';
                const cartasPorRonda = this.calcularCartasPorRonda();
                const apuestasRealizadas = this.apuestasRonda.length;
                const esUltimoJugador = apuestasRealizadas === this.jugadores - 1;
                
                // Calcular suma de apuestas anteriores
                const sumaApuestasAnteriores = this.apuestasRonda.reduce((sum, apuesta) => sum + apuesta.apuesta, 0);
                
                // Para el √∫ltimo jugador, calcular la apuesta prohibida
                let apuestaProhibida = null;
                if (esUltimoJugador) {
                    apuestaProhibida = this.rondaActual - sumaApuestasAnteriores;
                }
                
                // Generar botones del 0 al n√∫mero m√°ximo de cartas
                for (let apuesta = 0; apuesta <= cartasPorRonda; apuesta++) {
                    const button = document.createElement('button');
                    button.className = 'btn-apuesta';
                    button.textContent = apuesta;
                    button.dataset.apuesta = apuesta;
                    
                    // Deshabilitar bot√≥n si es el √∫ltimo jugador y la apuesta est√° prohibida
                    if (esUltimoJugador && apuesta === apuestaProhibida) {
                        button.classList.add('disabled');
                        button.title = `Esta apuesta har√≠a que la suma total sea ${this.rondaActual}, lo cual no est√° permitido`;
                    }
                    
                    button.addEventListener('click', () => this.seleccionarApuesta(apuesta, button));
                    
                    this.apuestasContainer.appendChild(button);
                }
                
                // Mostrar informaci√≥n de restricci√≥n para el √∫ltimo jugador
                if (esUltimoJugador && apuestaProhibida >= 0 && apuestaProhibida <= cartasPorRonda) {
                    this.apuestaProhibidaElement.textContent = apuestaProhibida;
                    this.rondaNumeroElement.textContent = this.rondaActual;
                    this.restriccionInfo.classList.remove('hidden');
                } else {
                    this.restriccionInfo.classList.add('hidden');
                }
                
                // Habilitar/deshabilitar bot√≥n de confirmar
                this.btnConfirmarApuesta.disabled = true;
            }

            seleccionarApuesta(apuesta, button) {
                // Si el bot√≥n est√° deshabilitado, no hacer nada
                if (button.classList.contains('disabled')) {
                    alert('Esta apuesta no est√° permitida porque har√≠a que la suma total sea igual al n√∫mero de ronda.');
                    return;
                }
                
                // Remover clase active de todos los botones
                document.querySelectorAll('.btn-apuesta').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // A√±adir clase active al bot√≥n seleccionado
                button.classList.add('active');
                
                // Guardar apuesta temporal
                this.apuestaTemporal = apuesta;
                
                // Habilitar bot√≥n de confirmar
                this.btnConfirmarApuesta.disabled = false;
            }

            confirmarApuesta() {
                if (typeof this.apuestaTemporal === 'undefined') {
                    alert('Por favor, selecciona una apuesta antes de confirmar.');
                    return;
                }
                
                const apuestasRealizadas = this.apuestasRonda.length;
                const jugadorIndex = (this.iniciadorRondaActual + apuestasRealizadas) % this.jugadores;
                const jugador = this.jugadoresData[jugadorIndex];
                const apuesta = this.apuestaTemporal;
                
                // Guardar apuesta
                jugador.apuestaActual = apuesta;
                this.apuestasRonda.push({
                    jugadorId: jugador.id,
                    jugadorNombre: jugador.nombre,
                    apuesta: apuesta
                });
                
                // Actualizar UI en la mesa
                const apuestaElement = document.getElementById(`apuesta-j${jugador.id}`);
                if (apuestaElement) {
                    apuestaElement.textContent = apuesta;
                    apuestaElement.style.color = 'var(--verde-medio)';
                    apuestaElement.style.fontWeight = 'bold';
                }
                
                // Actualizar contador de apuestas
                this.actualizarContadorApuestas();
                
                // Limpiar apuesta temporal
                this.apuestaTemporal = undefined;
                this.btnConfirmarApuesta.disabled = true;
                
                // Actualizar tarjetas
                this.actualizarTarjetasJugadores();
                
                // Verificar si ya todos apostaron
                if (this.apuestasRonda.length < this.jugadores) {
                    this.siguienteTurno();
                } else {
                    this.finalizarTurnos();
                }
            }

            actualizarContadorApuestas() {
                const apuestasRealizadas = this.apuestasRonda.length;
                this.contadorApuestasText.textContent = `Apuestas: ${apuestasRealizadas}/${this.jugadores}`;
            }

            finalizarTurnos() {
                this.modoTurno = false;
                this.turnoIndicator.classList.add('hidden');
                
                // Calcular suma total de apuestas
                const sumaApuestas = this.apuestasRonda.reduce((sum, a) => sum + a.apuesta, 0);
                
                // Verificar que la suma de apuestas no sea igual al n√∫mero de ronda
                if (sumaApuestas === this.rondaActual) {
                    alert('¬°Error! La suma de apuestas es igual al n√∫mero de ronda. Esto no deber√≠a ocurrir con el sistema de restricciones.');
                    return;
                }
                
                // Calcular diferencia respecto al n√∫mero de ronda
                const diferencia = sumaApuestas - this.rondaActual;
                
                // Mostrar mensaje informativo sobre apuestas de m√°s/menos
                this.mostrarMensajeApuestasInfo(diferencia, sumaApuestas);
                
                // Actualizar iniciador para la siguiente ronda (siguiente jugador)
                this.iniciadorRondaActual = (this.iniciadorRondaActual + 1) % this.jugadores;
                
                // Actualizar puntuaci√≥n parcial
                this.actualizarPuntuacionParcial();
                
                // Volver al marcador principal
                this.mostrarSeccion('marcador');
                
                // Habilitar bot√≥n para jugar la ronda
                this.btnJugarRonda.disabled = false;
                
                alert(`¬°Todas las apuestas han sido registradas!\nSuma total: ${sumaApuestas}\nN√∫mero de ronda: ${this.rondaActual}\nAhora juega la ronda y registra las bazas ganadas.`);
            }

            mostrarMensajeApuestasInfo(diferencia, sumaApuestas) {
                this.mensajeApuestasInfo.classList.remove('hidden');
                
                let mensaje = '';
                let claseDiferencia = '';
                
                if (diferencia > 0) {
                    mensaje = `Se han apostado <strong>${diferencia} ronda(s) de m√°s</strong>`;
                    claseDiferencia = 'mas';
                } else if (diferencia < 0) {
                    mensaje = `Se han apostado <strong>${Math.abs(diferencia)} ronda(s) de menos</strong>`;
                    claseDiferencia = 'menos';
                } else {
                    mensaje = `¬°Apuestas exactas!`;
                    claseDiferencia = 'exacto';
                }
                
                this.mensajeApuestasInfo.innerHTML = `
                    <div class="titulo">
                        <i class="fas fa-info-circle"></i> An√°lisis de Apuestas - Ronda ${this.rondaActual}
                    </div>
                    <div>
                        <strong>Suma total de apuestas:</strong> ${sumaApuestas}
                    </div>
                    <div>
                        <strong>N√∫mero de ronda:</strong> ${this.rondaActual}
                    </div>
                    <div class="diferencia ${claseDiferencia}">
                        ${mensaje}
                    </div>
                    <div style="font-size: 0.9rem; margin-top: 8px; color: var(--gris-oscuro);">
                        ${diferencia > 0 ? 
                            `Hay ${diferencia} bazas m√°s apostadas de las que deber√≠an haber.` : 
                            diferencia < 0 ? 
                            `Faltan ${Math.abs(diferencia)} bazas por apostar respecto al n√∫mero de ronda.` :
                            `La suma de apuestas coincide perfectamente con el n√∫mero de ronda.`
                        }
                    </div>
                `;
            }

            actualizarPuntuacionParcial() {
                // Ordenar jugadores por puntos (de mayor a menor)
                const jugadoresOrdenados = [...this.jugadoresData].sort((a, b) => b.puntos - a.puntos);
                
                let html = `
                    <thead>
                        <tr>
                            <th>Pos</th>
                            <th>Jugador</th>
                            <th>Puntos</th>
                            <th>Apuesta</th>
                            <th>Bazas</th>
                        </tr>
                    </thead>
                    <tbody>
                `;
                
                jugadoresOrdenados.forEach((jugador, index) => {
                    const posicion = index + 1;
                    const esPrimero = posicion === 1;
                    
                    html += `
                        <tr ${esPrimero ? 'style="background-color: rgba(255, 215, 0, 0.1);"' : ''}>
                            <td class="posicion">${posicion}¬∫</td>
                            <td class="jugador" title="${jugador.nombre}">${jugador.nombre}</td>
                            <td class="puntos">${jugador.puntos}</td>
                            <td class="apuesta-actual">${jugador.apuestaActual !== null ? jugador.apuestaActual : '-'}</td>
                            <td class="bazas-actual">${jugador.bazasActual}</td>
                        </tr>
                    `;
                });
                
                html += `</tbody>`;
                
                this.tablaPuntuacionParcial.innerHTML = html;
            }

            actualizarTarjetasJugadores() {
                document.querySelectorAll('.jugador-card').forEach(card => {
                    card.classList.remove('en-turno');
                });
                
                if (this.modoTurno && this.apuestasRonda.length < this.jugadores) {
                    const jugadorIndex = (this.iniciadorRondaActual + this.apuestasRonda.length) % this.jugadores;
                    const jugadorActual = this.jugadoresData[jugadorIndex];
                    const card = document.querySelector(`.jugador-card[data-id="${jugadorActual.id}"]`);
                    if (card) {
                        card.classList.add('en-turno');
                    }
                }
            }

            calcularCartasPorRonda() {
                if (this.rondaActual <= 5) {
                    // Ascendente: 1-5 cartas
                    return this.rondaActual;
                } else if (this.rondaActual <= 17) {
                    // 12 rondas de 6 cartas
                    return 6;
                } else if (this.rondaActual <= 22) {
                    // Descendente: 5-1 cartas
                    return 28 - this.rondaActual; // 28-23=5, 28-24=4, etc.
                } else {
                    // Finales: 2 rondas de 1 carta
                    return 1;
                }
            }

            getFaseActual() {
                if (this.rondaActual <= 5) return 'Ascendente';
                if (this.rondaActual <= 17) return 'Plena';
                if (this.rondaActual <= 22) return 'Descendente';
                return 'Final';
            }

            actualizarInfoRonda() {
                const fase = this.getFaseActual();
                const cartas = this.calcularCartasPorRonda();
                
                // Actualizar elementos del marcador
                this.currentRondaElement.textContent = this.rondaActual;
                this.currentTotalElement.textContent = this.totalRondas;
                this.currentFaseElement.textContent = fase;
                this.currentCartasElement.textContent = cartas;
                
                // Actualizar elementos del turno
                this.turnoRondaElement.textContent = this.rondaActual;
                this.turnoTotalElement.textContent = this.totalRondas;
                this.turnoCartasElement.textContent = cartas;
                this.turnoFaseElement.textContent = fase;
            }

            verResultadosParciales() {
                // Calcular puntos parciales
                const resultados = this.calcularPuntosParciales();
                
                let mensaje = `Resultados Parciales - Ronda ${this.rondaActual}\n\n`;
                resultados.forEach((r, i) => {
                    mensaje += `${i+1}¬∫: ${r.nombre} - ${r.puntos} pts\n`;
                    if (r.apuestaActual !== null) {
                        mensaje += `   Apuesta: ${r.apuestaActual}, Bazas: ${r.bazasActual}\n`;
                    }
                    mensaje += '\n';
                });
                
                alert(mensaje);
            }

            calcularPuntosParciales() {
                return this.jugadoresData.map(jugador => ({
                    nombre: jugador.nombre,
                    puntos: jugador.puntos,
                    apuestaActual: jugador.apuestaActual,
                    bazasActual: jugador.bazasActual
                })).sort((a, b) => b.puntos - a.puntos);
            }

            siguienteRonda() {
                if (confirm('¬øEst√°s seguro de que quieres pasar a la siguiente ronda? Se calcular√°n los puntos de esta ronda.')) {
                    this.calcularRonda();
                    
                    if (this.rondaActual < this.totalRondas) {
                        this.rondaActual++;
                        
                        // Reiniciar contadores para nueva ronda
                        this.jugadoresData.forEach(jugador => {
                            jugador.apuestaActual = null;
                            jugador.bazasActual = 0;
                        });
                        
                        // Ocultar mensaje informativo
                        this.mensajeApuestasInfo.classList.add('hidden');
                        
                        // Actualizar UI
                        this.actualizarInfoRonda();
                        this.resetearContadoresUI();
                        this.actualizarPuntuacionParcial();
                        
                        // Iniciar turnos para nueva ronda
                        this.iniciarTurnos();
                    } else {
                        this.finalizarPartida();
                    }
                }
            }

            calcularRonda() {
                // Calcular puntos para cada jugador
                this.jugadoresData.forEach(jugador => {
                    if (jugador.apuestaActual === null) {
                        alert(`Error: ${jugador.nombre} no tiene apuesta registrada.`);
                        return;
                    }
                    
                    const diferencia = Math.abs(jugador.apuestaActual - jugador.bazasActual);
                    let puntosRonda = 0;
                    
                    if (diferencia === 0) {
                        // Acert√≥ exacto - usar sistema de puntuaci√≥n personalizado
                        puntosRonda = this.puntuaciones[jugador.apuestaActual] || 0;
                    } else {
                        // No acert√≥ - penalizaci√≥n por cada apuesta fallada
                        puntosRonda = - (diferencia * this.penalizacionPorFallar);
                    }
                    
                    jugador.puntos += puntosRonda;
                    
                    // Guardar historial
                    jugador.historial.push({
                        ronda: this.rondaActual,
                        apuesta: jugador.apuestaActual,
                        bazas: jugador.bazasActual,
                        puntos: puntosRonda,
                        puntosTotales: jugador.puntos
                    });
                });
                
                // Actualizar puntos en la UI
                this.actualizarPuntosJugadores();
                
                // Actualizar puntuaci√≥n parcial
                this.actualizarPuntuacionParcial();
                
                // Mostrar resumen de la ronda
                this.mostrarResumenRonda();
            }

            actualizarPuntosJugadores() {
                this.jugadoresData.forEach(jugador => {
                    const puntosElement = document.querySelector(`.jugador-card[data-id="${jugador.id}"] .jugador-puntos`);
                    if (puntosElement) {
                        puntosElement.textContent = jugador.puntos;
                        // Animaci√≥n
                        puntosElement.style.transform = 'scale(1.3)';
                        puntosElement.style.transition = 'transform 0.3s';
                        setTimeout(() => {
                            puntosElement.style.transform = 'scale(1)';
                        }, 300);
                    }
                });
            }

            mostrarResumenRonda() {
                let mensaje = `Resumen Ronda ${this.rondaActual}:\n\n`;
                
                this.jugadoresData.forEach(jugador => {
                    const diferencia = Math.abs(jugador.apuestaActual - jugador.bazasActual);
                    const historial = jugador.historial[jugador.historial.length - 1];
                    const puntosRonda = historial ? historial.puntos : 0;
                    
                    mensaje += `${jugador.nombre}: ${jugador.apuestaActual}/${jugador.bazasActual} `;
                    mensaje += `‚Üí ${puntosRonda >= 0 ? '+' : ''}${puntosRonda} pts\n`;
                });
                
                alert(mensaje);
            }

            resetearContadoresUI() {
                // Resetear apuestas
                this.jugadoresData.forEach(jugador => {
                    const apuestaElement = document.getElementById(`apuesta-j${jugador.id}`);
                    if (apuestaElement) {
                        apuestaElement.textContent = '-';
                        apuestaElement.style.color = '';
                        apuestaElement.style.fontWeight = '';
                    }
                });
                
                // Resetear bazas
                document.querySelectorAll('.bazas-count').forEach(span => {
                    span.textContent = '0';
                });
            }

            finalizarPartida() {
                if (confirm('¬øEst√°s seguro de que quieres finalizar la partida?')) {
                    // Calcular √∫ltima ronda si no se ha calculado
                    if (this.jugadoresData[0].apuestaActual !== null) {
                        this.calcularRonda();
                    }
                    
                    this.partidaActiva = false;
                    this.mostrarResultadosFinales();
                    this.mostrarSeccion('resultados');
                }
            }

            mostrarResultadosFinales() {
                // Ordenar jugadores por puntos
                const jugadoresOrdenados = [...this.jugadoresData].sort((a, b) => b.puntos - a.puntos);
                
                let html = `
                    <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                        <thead>
                            <tr style="background: linear-gradient(135deg, var(--verde-principal), var(--verde-oscuro)); color: var(--blanco);">
                                <th style="padding: 15px; text-align: left;">Posici√≥n</th>
                                <th style="padding: 15px; text-align: left;">Jugador</th>
                                <th style="padding: 15px; text-align: left;">Puntos Totales</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                jugadoresOrdenados.forEach((jugador, index) => {
                    const posicion = index + 1;
                    const esGanador = posicion === 1;
                    const estiloFila = esGanador ? 
                        'background: linear-gradient(135deg, var(--amarillo), #ffd700); font-weight: bold; color: var(--verde-oscuro);' : 
                        '';
                    
                    html += `
                        <tr style="${estiloFila}">
                            <td style="padding: 15px; border-bottom: 1px solid var(--gris-medio);">${posicion}¬∫</td>
                            <td style="padding: 15px; border-bottom: 1px solid var(--gris-medio);">${jugador.nombre}</td>
                            <td style="padding: 15px; border-bottom: 1px solid var(--gris-medio);">${jugador.puntos}</td>
                        </tr>
                    `;
                });
                
                html += `
                        </tbody>
                    </table>
                `;
                
                document.getElementById('tabla-resultados').innerHTML = html;
            }

            nuevaPartida() {
                if (confirm('¬øComenzar una nueva partida? Se perder√°n los datos de la partida actual.')) {
                    // Reiniciar todo
                    this.jugadores = 6;
                    this.jugadoresData = [];
                    this.rondas = [];
                    this.rondaActual = 1;
                    this.turnoActual = 0;
                    this.iniciadorRondaActual = 0;
                    this.apuestasRonda = [];
                    this.partidaActiva = false;
                    this.modoTurno = false;
                    
                    // Actualizar botones del men√∫
                    this.btnJugadores.forEach(btn => {
                        btn.classList.remove('active');
                        if (parseInt(btn.dataset.jugadores) === 6) {
                            btn.classList.add('active');
                        }
                    });
                    
                    // Volver al men√∫ principal
                    this.mostrarSeccion('menu');
                    this.actualizarInfoPartida();
                }
            }

            mostrarSeccion(seccion) {
                // Ocultar todas las secciones
                document.querySelectorAll('.section').forEach(s => {
                    s.classList.remove('active');
                });
                
                // Mostrar secci√≥n solicitada
                if (seccion === 'menu') {
                    this.menuSection.classList.add('active');
                } else if (seccion === 'config') {
                    this.configSection.classList.add('active');
                } else if (seccion === 'turno') {
                    this.turnoSection.classList.add('active');
                } else if (seccion === 'marcador') {
                    this.marcadorSection.classList.add('active');
                } else if (seccion === 'resultados') {
                    this.resultadosSection.classList.add('active');
                }
            }
        }

        // Inicializar la aplicaci√≥n cuando se cargue la p√°gina
        document.addEventListener('DOMContentLoaded', () => {
            window.galiPocha = new GaliPochaApp();
            
            // Efecto de carga suave
            document.body.style.opacity = '0';
            setTimeout(() => {
                document.body.style.transition = 'opacity 0.5s';
                document.body.style.opacity = '1';
            }, 100);
            
            // Configuraci√≥n para m√≥viles
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('/sw.js').catch(error => {
                        console.log('Service Worker registration failed:', error);
                    });
                });
            }
            
            // Prevenir zoom en dispositivos m√≥viles
            document.addEventListener('touchstart', (e) => {
                if (e.touches.length > 1) {
                    e.preventDefault();
                }
            }, { passive: false });
            
            let lastTouchEnd = 0;
            document.addEventListener('touchend', (e) => {
                const now = Date.now();
                if (now - lastTouchEnd <= 300) {
                    e.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
            
            // Mensaje de bienvenida
            setTimeout(() => {
                console.log('üé¥ GaliPocha by Ferteam - Sistema de turnos rotativos cargado');
            }, 1000);
        });
    </script>
</body>
</html>